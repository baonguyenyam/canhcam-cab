"use strict";function xoaTab(t,e){if(t.preventDefault(),!confirm("Bạn có chắc chắn xóa nó?"))return!1;$(e).parents("li").remove();var a=$(e).attr("data-id");deleteArrayPage($(e).parents("li").attr("data-tab-name")),$("#"+a).remove(),$("#myTab li:first-child > a").trigger("click")}function checkTab(){0<$("#myTab").html().trim().length?($("#myTab").addClass("cnt"),$(".notedcanhcam").hide(),$(".createcanhcam").show(),$(".deview").show(),$(".bleft").show()):($(".notedcanhcam").show(),$(".deview").hide(),$(".createcanhcam").hide(),$("#myTab").removeClass("cnt"),$(".bleft").hide())}function createLeftMenuList(){jQuery.get("/data.json",function(t){var e=t,a=0;for(var n in e){var i=Object.keys(e[n]).length;a=+a+i;var o=document.createElement("div");for(var d in o.id="cc-menu-"+n,o.setAttribute("data-tab-id",taoIdNgauNhien(25)),o.innerHTML='<div class="card"><div class="card-header" id="heading-'+n+'"><h5 class="mb-0"><button class="btn btn-link collapsed d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#collapse-'+n+'" aria-expanded="true" aria-controls="collapse-'+n+'">'+n.replace("-"," ").toUpperCase()+' <span class="badge badge-secondary">'+i+'</span></button></h5></div><div id="collapse-'+n+'" class="collapse" aria-labelledby="heading-'+n+'" data-parent="#accordion"><div class="card-body"><div class="slider-items list-group mainList"></div></div></div>',$("#accordion").append(o),e[n]){var s=e[n][d][0],r=e[n][d][1],c=e[n][d][2],l=e[n][d][3],m="",f="";e[n][d][4]&&e[n][d][4].length&&(m='data-height="'+e[n][d][4]+'"'),e[n][d][5]&&e[n][d][5].length&&(f='data-noted="'+e[n][d][5]+'"');var h='<div class="list-group-item" '+m+" "+f+' data-key="'+s+'" data-type="'+r+'"><h5><a href="/templates/index-'+s.replace("/","-")+'.html" target="_blank">'+l+'</a></h5><figure><img src="./img/layout/'+c+'" alt=""></div></figure></div>';n&&($("#cc-menu-"+n).length&&$("#cc-menu-"+n+" .mainList").append(h),$(".mainList").each(function(t,e){new Sortable.create(e,{group:{name:"mainList",pull:"clone",put:!1},ghostClass:"canhcam-ghost",sort:!1,animation:100,onMove:function(t,e){$("#nav-tabContent").addClass("active")},onClone:function(t){$("#nav-tabContent").addClass("active")},onStart:function(t){$("#nav-tabContent").addClass("active")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),toggleContentReady()}})}))}0}buildTotal(a)})}function buildTotal(a){jQuery.get("/version.json",function(t){var e=t;$("#version").html(e.version+" "+e.build),$("#accordion").append('<div class="total p-2 small">S&#x1ED1; th&#xE0;nh ph&#x1EA7;n: <span class="text-info">'+a+'</span><br>T&#x1EAD;p tin: <span class="text-info">'+(3*a+9)+'</span><br>Site vừa tạo: <span class="text-info justbuild"></span><br>Phi&#xEA;n b&#x1EA3;n: <span class="text-info">'+e.version+" "+e.build+'</span><br>Phi&#xEA;n b&#x1EA3;n Bootstrap: <span class="text-info">'+e.bootstrap+'</span><br>T&#xE1;c gi&#x1EA3;: <span class="text-info">B&#x1EA3;o Nguy&#xEA;n</span></div>'),$("#logopage .text-info").html("CAB")}),jQuery.get("/justbuild.json",function(t){var e=t;$(".justbuild").html("@SITE/"+e.sitename)})}function removeVietnam(t){var e=t.toLowerCase().replace(/\s+/g,"-"),a={"-":'[`~!@#$%^&*()_|+=?;:",.<>/]',a:"[ảàạảãàáâãäåắặẳằẵấầẩẫậâă]",ae:"æ",c:"ç",e:"[èéẹẽẻềệếểễê]",d:"[đ]",i:"[ìíîïị]",n:"ñ",o:"[òóôõöộồốổỗơởợỡờớôơ]",oe:"œ",u:"[ùúûűüủụưửựứừữư]",y:"[ýỳỷỵỹ]"};for(var n in a)e=e.replace(new RegExp(a[n],"gi"),n);return e=e.replace(/[^\w\s]/gi,"-")}function taoIdNgauNhien(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<t;n++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}function kiemTraTenTrang(t,e){return-1<$.inArray(t,e)}function checkFormDisable(t,e){$("#"+t).prop("checked")?$("#"+e).attr("disabled",!1):$("#"+e).attr("disabled",!0),$("#"+e).prop("checked",!1)}function saveToData(t,e){if(!confirm("Bạn có chắc chắn lưu ngay bây giờ?"))return!1;jQuery.post("/savedata",{dataColor:t,dataJS:e},function(t){"done"===t&&$("#exampleModalCenter").modal("hide")})}function getDataColor(){jQuery.get("/getdata",function(t){var e=JSON.parse(t),a=0;for(var n in e){var i=n,o=e[n],d=document.createElement("div");d.className="col-12 mt-3",d.innerHTML="<h5>Màu Phụ</h5><hr>";var s=document.createElement("div");s.className="col-sm-6 col-lg-3",s.innerHTML='<div class="form-group"><div class="input-group colorpicker-component cppicker"><div class="input-group-prepend"><span class="input-group-text">'+i+'</span></div><input type="text" class="form-control" value="'+o+'"><span class="input-group-addon"><i></i></span></div></div>',4==a&&document.getElementById("maincolor").appendChild(d),document.getElementById("maincolor").appendChild(s),$(".cppicker").colorpicker(),a++}})}function getDataJS(){jQuery.get("/getdatajs",function(t){var e=JSON.parse(t);for(var a in e)"number"==typeof e[a]?$("[data-key='"+a+"']").val(e[a]):e[a]?$("[data-key='"+a+"']").prop("checked",!0):$("[data-key='"+a+"']").prop("checked",!1),0})}function resizeFrame(){$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(".ifthumnails").each(function(){var e=this;$(this).removeAttr("style"),$(this).find("iframe").removeAttr("style");var t=$(this).parents(".list-group-item");if(t.attr("data-height")&&t.attr("data-height").length){var a=t.attr("data-height");setTimeout(function(){$(e).css({height:a}),$(e).find("iframe").css({height:a})},1e3)}else setTimeout(function(){var t=$(e).find("iframe").contents().height();$(e).css({height:t+"px"}),$(e).find("iframe").css({height:t+"px"})},1e3)}),setTimeout(function(){loadingPage()},1e3)}function loadingPage(){$("body").addClass("pace-done").removeClass("pace-running"),$(".pace").addClass("pace-inactive")}function toggleContentReady(){var t=!0;$(".newlist").each(function(){0<$(this).html().trim().length?(t=!1,$(this).addClass("cnt")):$(this).removeClass("cnt")}),t||unSavePage()}function addClickDel(t){$("#edit-"+t).css({cursor:"pointer"}),$("#edit-"+t).click(function(){setTimeout(function(){$("#"+t).focus().click()},100)})}function buildFormAddComponent(){$("#formAddComponent select").html("<option selected disabled>Vui lòng chọn</option>"),$("#formAddComponent")[0].reset(),$("#formAddComponent .textresult").html("..."),jQuery.get("/data.json",function(t){var e="";for(var a in t)if(t.hasOwnProperty(a)){var n=Object.keys(t[a]).length;e+="<option data-comnum="+(n+1)+" data-type="+("header"===a?"header":"footer"===a?"footer":"body")+" data-count="+a.charAt(0)+"-"+(n+1)+" value="+a+">"+a.charAt(0).toUpperCase()+a.slice(1)}$("#formAddComponent select").append(e).on("change",function(t){var e=$("option:selected",this).attr("data-count"),a=$("option:selected",this).attr("data-type"),n=$("option:selected",this).attr("data-comnum");$("#formAddComponent .textresult").html(t.target.value+"/"+e),$("#formAddComponent #comkey").val(e),$("#formAddComponent #commain").val(a),$("#formAddComponent #comnum").val(n),$("#formAddComponent #nameCompo").val(t.target.value.charAt(0).toUpperCase()+t.target.value.slice(1).replace("-"," ")+" "+n)})})}function unSavePage(){$(window).bind("beforeunload",function(){return"Bạn có muốn thoát trang ngay bây giờ?"})}$(function(){addClickDel("projectname"),$('[data-toggle="tooltip"]').tooltip(),$("#projectname").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,e){var a=removeVietnam(e.trim());objectName=a,t.text(a)}}),checkFormDisable("customCheck1","customCheck2"),$("#customCheck1").click(function(){checkFormDisable("customCheck1","customCheck2")}),$("#addComponent").click(function(t){buildFormAddComponent()}),$("#addElements").click(function(t){buildFormAddComponentDAB()}),$("#preCreateSite").click(function(t){location.reload()}),$(".togglemenu").click(function(){$("#maincc").toggleClass("active"),$(this).toggleClass("active"),"dab"===modeCAD?reFrame():resizeFrame()}),$("#tooglepc").click(function(){$(this).addClass("active"),$("#toogletablet, #tooglemobile").removeClass("active"),$(".maindev").addClass("pc").removeClass("mobile").removeClass("tablet"),resizeFrame()}),$("#tooglemobile").click(function(){$(this).addClass("active"),$("#toogletablet, #tooglepc").removeClass("active"),$(".maindev").addClass("mobile").removeClass("pc").removeClass("tablet"),resizeFrame()}),$("#toogletablet").click(function(){$(this).addClass("active"),$("#tooglemobile, #tooglepc").removeClass("active"),$(".maindev").addClass("tablet").removeClass("mobile").removeClass("pc"),resizeFrame()}),$("#toogledev").click(function(){$(this).addClass("active"),$("#accordion-dab").removeClass("mode"),$(".frameNewlist").removeClass("d-none").addClass("d-block"),$(".framePreview").removeClass("d-block").addClass("d-none"),$(".frameEdit").removeClass("d-block").addClass("d-none"),$("#tooglepreview, #toogleedit").removeClass("active"),$(".maindev").addClass("dev").removeClass("edit").removeClass("preview"),modeDev()}),$("#toogleedit").click(function(){$(this).addClass("active"),$("#accordion-dab").addClass("mode"),$(".frameNewlist").removeClass("d-block").addClass("d-none"),$(".framePreview").removeClass("d-block").addClass("d-none"),$(".frameEdit").removeClass("d-none").addClass("d-block"),$("#tooglepreview, #toogledev").removeClass("active"),$(".maindev").addClass("edit").removeClass("dev").removeClass("preview"),modeEdit()}),$("#tooglepreview").click(function(){$(this).addClass("active"),$("#accordion-dab").addClass("mode"),$(".frameNewlist").removeClass("d-block").addClass("d-none"),$(".framePreview").removeClass("d-none").addClass("d-block"),$(".frameEdit").removeClass("d-block").addClass("d-none"),$("#toogleedit, #toogledev").removeClass("active"),$(".maindev").addClass("preview").removeClass("edit").removeClass("dev"),modePreview()}),$("#noleft").on("click",".xoatab",function(t){$(this).parents(".nav-link").trigger("click");xoaTab(t,this),checkTab()}),$("#toDoListMain").on("keyup",function(t){if(13===(t.keyCode||t.which))return t.preventDefault(),$(this).find("#buttonListItemMain").trigger("click"),!1}),$("#toDoList").on("keyup keypress",function(t){if(13===(t.keyCode||t.which))return t.preventDefault(),$(this).find("#createPage").trigger("click"),!1}),$("#saveConfig").click(function(){var t,a=[],n=[];$("#settings input[type=text]").each(function(){var t=$(this).val(),e=$(this).parents(".cppicker").find(".input-group-text").html();a.push(e+": "+t)}),$("#jsf input[type=checkbox]").each(function(){var t=$(this).prop("checked"),e=$(this).attr("data-key");n.push('"'+e+'":'+t)}),$("#jsf input[type=text]").each(function(){var t=$(this).val(),e=$(this).attr("data-key");n.push('"'+e+'":'+t)}),t="const CANHCAM_APP = {"+n+"}",saveToData(("$mau: ("+a+")").toString(),t.toString())}),createLeftMenuList(),getDataColor(),getDataJS()}),$(window).resize(function(){"dab"===modeCAD?reFrame():resizeFrame()}),$(document).ready(function(){setTimeout(function(){var t=$(".memory").attr("data-memory").split(";");$("#accordion .total").append('<br>Bộ nhớ sử dụng: <span class="text-info">'+parseInt(t[1]).toFixed(0)+"MB</span>"),$("#accordion .total").append('<br>Platform: <span class="text-info">'+t[3].charAt(0).toUpperCase()+t[3].slice(1)+"</span>"),$("#accordion .total").append('<br>Node: <span class="text-info">v'+t[4]+"</span>"),$("#aboutBox .sn").html($("html").attr("serial-key")),$("#aboutBox .hk").html($("html").attr("hash-key")),$("#aboutBox .lk").html($("body").attr("license-key"))},1e3)});var data={SETUP:{}},modeCAD="cab",objectName="",pagesLists=["index"],dataSites={color:"main: #2e3192,extra: #ec8b00,front: #659f13,back: #f1c40f,cyan-1: #1abc9c,cyan-2: #16a085,la-1: #2ecc71,la-2: #27ae60,duong-1: #3498db,duong-2: #2980b9,tim-1: #9b59b6,tim-2: #8e44ad,vang-1: #f1c40f,vang-2: #f39c12,cam-1: #e67e22,cam-2: #d35400,do-1: #e74c3c,do-2: #c0392b,den-1: #34495e,den-2: #2c3e50,xam-1: #95a5a6,xam-2: #7f8c8d,hong-1: #ff9ff3,hong-2: #f368e0,trang: #ffffff,den: #000000",js:'"ACTIVE_FIXED_HEADER": false,"HEADER_TRANPARENT": false,"ACTIVE_HEADER_POSITION": 1,"ACTIVE_PADDING_MAIN": true,"ACTIVE_VALIDATOR": true,"ACTIVE_SELECT": true,"ACTIVE_FIXED_FOOTER": true,"ACTIVE_LIST_TO_SELECT": true,"DISPLAY_FOOTER": 600,"ACTIVE_RESPONSIVE": true,"ACTIVE_BACKTOTOP": true,"DISPLAY_BACKTOTOP": 100,"CHANGE_GRID": 991,"CHANGE_GRID_SM": 767,"DEV_MODE": false,"DEV_MODE_GIRD_FULL": false'};function setDefault(){var t,e;t="$mau: ("+dataSites.color+")",e="const CANHCAM_APP = {"+dataSites.js+"}",saveToData(t.toString(),e.toString())}function createPageBuilder(n){data.SETUP[n]=[],$(".newlist").each(function(t,e){var a=new Sortable.create(e,{group:{put:"mainList",pull:!1},onMove:function(t,e){$("#nav-tabContent").addClass("active"),$(".accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$(".accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$(".accordion").addClass("remove")},onRemove:function(t){o()},onAdd:function(t){var e=t.item,a=$(e).attr("data-key").replace("/","-"),n=taoIdNgauNhien(10);if($(e).append('<span class="btn btn-sm btn-danger js-remove" data-id="fg"><i class="fa fa-close"></i></span><div id="'+n+'" class="ifthumnails"><iframe src="./templates/index-'+a+'.html" frameborder="0" onload="this.style.opacity = 1"></iframe></div>'),$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(e).attr("data-height")&&$(e).attr("data-height").length){var i=$(e).attr("data-height");setTimeout(function(){$("#"+n).css({height:i}),$("#"+n+" iframe").css({height:i}),loadingPage()},1e3)}else setTimeout(function(){var t=$("#"+n+" iframe").contents().height();$("#"+n).css({height:t+"px"}),$("#"+n+" iframe").css({height:t+"px"}),loadingPage()},1e3);o()},onUpdate:function(t){var e=t.item;if($(e).find("iframe").removeAttr("style"),$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(e).attr("data-height")&&$(e).attr("data-height").length){var a=$(e).attr("data-height");setTimeout(function(){$(e).find("iframe").css({height:a}),loadingPage()},3e3)}else setTimeout(function(){var t=$(e).find("iframe").contents().height();$(e).find("iframe").css({height:t+"px"}),loadingPage()},3e3);o()},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$(".accordion").removeClass("remove"),toggleContentReady()},animation:100,filter:".js-remove",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;var e=a.closest(t.item);e&&e.parentNode.removeChild(e),o(),toggleContentReady()}});function o(){var t={header:[],body:[],footer:[]};$(e).find(".list-group-item").each(function(){"header"===$(this).attr("data-type")?t.header.push($(this).attr("data-key")):"body"===$(this).attr("data-type")?t.body.push($(this).attr("data-key")):t.footer.push($(this).attr("data-key"))}),data.SETUP[n]=t}$(".mainList").on("dragenter",function(){$(".sortable-ghost",e).remove()})})}function taoTrangIndex(){if(1==pagesLists.length){var t="index";$(".noleft .nav-tabs").append('<li class="nav-item" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i>'+t+".html</a></li>"),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="index" role="tabpanel" aria-labelledby="index-tab"><div class="list-group newlist"></div></div>'),$("#toDoList")[0].reset(),$("#index-tab").trigger("click"),createPageBuilder(t),checkTab()}}function deleteArrayPage(t){var e=pagesLists.indexOf(t);-1<e&&pagesLists.splice(e,1),data.SETUP[t]=null,delete data.SETUP[t]}function changePageName(t,e){var a=pagesLists.indexOf(e);-1<a&&pagesLists.splice(a,1,t),data.SETUP[t]=data.SETUP[e],data.SETUP[e]=null,delete data.SETUP[e]}$("#buttonListItemMain").click(function(){var e=removeVietnam($("input[name=ListItemMain]").val().trim());modeCAD=$("#cab-dab").val(),jQuery.post("/checksite",{site:e},function(t){return!!e&&("done"!==t?(alert("KHÔNG THÀNH CÔNG! Đã tồn tại dự án với tên này!"),!1):(objectName=e,alert("Thêm dự án thành công!, hãy tiếp tục tạo page trên dự án."),$("#projectname").html(""+objectName),$("#toDoListMain").hide(),$("#toDoListMain")[0].reset(),"dab"===modeCAD?toggleDAB():($("#toDoList").show(),$("#accordion").addClass("active"),$("#accordion-dab").hide(),taoTrangIndex()),void showTour()))})}),$("#formAddComponentDAB button").click(function(t){var e=new FormData($("#formAddComponentDAB")[0]);return $.ajax({url:"/upload-dab",type:"POST",contentType:!1,processData:!1,cache:!1,data:e,success:function(){alert("Upload hoàn tất"),$("#ElmModalCenter").modal("hide"),$("#formAddComponentDAB")[0].reset(),$("#formAddComponentDAB .textresult").html("...")},error:function(){alert("Lỗi khi đăng bài!")}}),!1}),$("#formAddComponent button").click(function(t){var e=new FormData($("#formAddComponent")[0]);return $.ajax({url:"/upload",type:"POST",contentType:!1,processData:!1,cache:!1,data:e,success:function(){alert("Upload hoàn tất"),$("#addCompo").modal("hide"),$("#formAddComponent")[0].reset(),$("#formAddComponent .textresult").html("...")},error:function(){alert("Lỗi khi upload!")}}),!1}),$("#createSite").click(function(t){if(t.preventDefault(),"dab"===modeCAD)createSiteDAB();else{if(!(0<$("#nav-tabContent #index .newlist .list-group-item").length))return alert("Bạn chưa có nội dung cho file index"),!1;var e=data;if(!confirm("Bạn có chắc chắn tạo site ngay bây giờ?"))return!1;jQuery.post("/createsite",{name:objectName,data:e},function(t){"done"===t&&($("#toDoListMain").show(),$("#toDoList, .deview").hide(),$(".notedcanhcam").show(),$(".notedcanhcam .alert").show(),$(".createcanhcam").hide(),$(".bleft").hide(),$(".enterpro").hide(),$("#myTab").removeClass("cnt"),$("#myTab, #nav-tabContent").html(""),t={SETUP:{}},objectName="",pagesLists=["index"])})}}),$("#createPage").click(function(){var t=removeVietnam($("input[name=ListItem]").val().trim());if("dab"===modeCAD)checkReadyTabDAB(t);else if(kiemTraTenTrang(t,pagesLists))alert("Chưa nhập tên hoặc đã tồn tại trang này!"),$("#toDoList")[0].reset();else{if(!t)return!1;$(".noleft .nav-tabs").append('<li class="nav-item page-tab" data-tab-name="'+t+'" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i><abbr data-original-title="Edit" class="name-tab">'+t+'</abbr>.html<span class="btn btn-sm btn-danger xoatab" data-id="'+t+'"><i class="fa fa-close"></i></span></a></li>'),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="'+t+'" role="tabpanel" aria-labelledby="'+t+'-tab"><div class="list-group newlist"></div></div>'),$("#toDoList")[0].reset(),$("#"+t+"-tab").trigger("click"),createPageBuilder(t),checkTab(),pagesLists.push(t),$("#myTab .page-tab .nav-link .name-tab").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,e){var a=removeVietnam(e.trim());if(kiemTraTenTrang(a,pagesLists))t.text(t.innerText);else{t.text(a);var n=$(t).parents(".nav-item").attr("data-tab-name");$(t).parents(".nav-item").attr("data-tab-name",a),$(t).parents(".nav-link").attr({id:a+"-tab","aria-controls":a,href:"#"+a}),$("#nav-tabContent").find("#"+n).attr({id:a,"aria-labelledby":a+"-tab"}),changePageName(a,n)}}})}}),document.onkeyup=function(t){if((t=t||window.event).altKey&&t.ctrlKey&&t.shiftKey&&13==t.which)return $("body"),alert("BAO NGUYEN - 0969689893\nEmail: baonguyenyam@gmail.com\nWeb: baonguyenyam.github.io"),!1};var dab={modeSwitch:"dev",keyEdit:null,frameEdit:null};function toggleDAB(){$("#accordion-dab").addClass("active"),$("#accordion, #addComponent, #stCssJS, .notedcanhcam").hide(),$("#toDoList, .bleft, .deview, #addElements, #layoutmode").show(),createLeftMenuListDAB(),taoTrangIndexDAB()}function createPageBuilderDAB(t){data.SETUP[t]=""}function createSiteDAB(){if(modePreview(),$("iframe.framePreview").each(function(){var t=$(this).closest(".tab-pane").attr("id"),e=$(this).contents().find("body").html();data.SETUP[t]=e}),!(0<$("#nav-tabContent #index .frameNewlist").contents().find("#listWithHandle").html().length))return alert("Bạn chưa có nội dung cho file index"),!1;var t=data;if(!confirm("Bạn có chắc chắn tạo site ngay bây giờ?"))return!1;jQuery.post("/createdab",{name:objectName,data:t},function(t){"done"===t&&($("#toDoListMain").show(),$("#toDoList, .deview").hide(),$(".notedcanhcam").show(),$(".notedcanhcam .alert").show(),$(".createcanhcam").hide(),$(".bleft").hide(),$(".enterpro").hide(),$("#myTab").removeClass("cnt"),$("#myTab, #nav-tabContent").html(""),t={SETUP:{}},objectName="",pagesLists=["index"])})}function modeEdit(){dab.modeSwitch="edit",clearAllFrame(dab.modeSwitch),$("#nav-tabContent .tab-pane.active").each(function(t,e){$(this).find("iframe.frameEdit").contents().find("body").html("");var a=$(this).find("iframe.frameNewlist").contents().find("#listWithHandle").html(),n=$(this).find("iframe.frameEdit").contents();n.find("body").html(a),changeDAD(n)}),$("#editContentModal").on("hide.bs.modal",function(t){$("#editContentModal .modal-body").html("")}),$('#myTab a[data-toggle="tab"]').on("shown.bs.tab",function(t){"edit"===dab.modeSwitch&&($("#nav-tabContent .tab-pane.active").each(function(t,e){$(this).find("iframe.frameEdit").contents().find("body").html("");var a=$(this).find("iframe.frameNewlist").contents().find("#listWithHandle").html(),n=$(this).find("iframe.frameEdit").contents();n.find("body").html(a),changeDAD(n)}),reFrame())}),reFrame()}function changeDAD(a){a.find(".dab-item-remove").each(function(){$(this).click(function(){var t=$(this).attr("data-id"),e=a.find("#"+t).attr("data-content");$("#editContentModal .modal-body").html('<textarea name="editor" id="editor" rows="10" cols="80"></textarea>'),$("#editContentModal #editor").val(unescape(e)),CKEDITOR.replace("editor"),dab.keyEdit=t,dab.frameEdit=a,$("#editContentModal").modal("show")})})}function clearAllFrame(t){"dev"===t?($("#nav-tabContent .tab-pane").each(function(t,e){$(this).find("iframe.frameEdit").contents().find("body").html("")}),$("#nav-tabContent .tab-pane").each(function(t,e){$(this).find("iframe.framePreview").contents().find("body").html("")})):"preview"===t?$("#nav-tabContent .tab-pane").each(function(t,e){$(this).find("iframe.frameEdit").contents().find("body").html("")}):$("#nav-tabContent .tab-pane").each(function(t,e){$(this).find("iframe.framePreview").contents().find("body").html("")})}function modeDev(){dab.modeSwitch="dev",clearAllFrame(dab.modeSwitch),reFrame()}function modePreview(){dab.modeSwitch="preview",clearAllFrame(dab.modeSwitch),$("#nav-tabContent .tab-pane").each(function(t,e){var a=$(this).find("iframe.frameNewlist").contents().find("#listWithHandle").html(),n=[".dab-item-remove"],i=["data-title","data-content","data-key","data-dab","draggable"],o=["dab-item-gird","dab-item-col","dab-item-row"],d=$(this).find("iframe.framePreview").contents();for(var s in d.find("body").html(a),n)if(n.hasOwnProperty(s)){var r=n[s];d.find(r).remove()}for(var s in i)if(i.hasOwnProperty(s)){r=i[s];d.find("["+r+"]").removeAttr(r)}for(var s in o)if(o.hasOwnProperty(s)){r=o[s];d.find("."+r).removeClass(r)}d.find('*[id^="dab-item-"]').removeAttr("id"),$(d).find(".dab-item").each(function(){var t=$(this).children();$(t).parent().is(".dab-item")&&$(t).unwrap()})}),$('#myTab a[data-toggle="tab"]').on("shown.bs.tab",function(t){reFrame()}),reFrame()}function checkReadyTabDAB(t){if(kiemTraTenTrang(t,pagesLists))alert("Chưa nhập tên hoặc đã tồn tại trang này!"),$("#toDoList")[0].reset();else{if(!t)return!1;var e=document.createElement("iframe");e.src="/views/iframe.html",e.width="100%",e.className="frameNewlist",e.onload=function(){taoIframe(e)},$(".noleft .nav-tabs").append('<li class="nav-item page-tab" data-tab-name="'+t+'" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i><abbr data-original-title="Edit" class="name-tab">'+t+'</abbr>.html<span class="btn btn-sm btn-danger xoatab" data-id="'+t+'"><i class="fa fa-close"></i></span></a></li>'),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="'+t+'" role="tabpanel" aria-labelledby="'+t+'-tab"></div>'),$("#toDoList")[0].reset(),$("#"+t).html(e),$("#"+t).append('<iframe src="/views/mode.html" class="framePreview d-none"></iframe>'),$("#"+t).append('<iframe src="/views/edit.html" class="frameEdit d-none"></iframe>'),$("#"+t+"-tab").trigger("click"),$("#toogledev").trigger("click"),createPageBuilderDAB(t),checkTab(),pagesLists.push(t),$("#myTab .page-tab .nav-link .name-tab").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,e){var a=removeVietnam(e.trim());if(kiemTraTenTrang(a,pagesLists))t.text(t.innerText);else{t.text(a);var n=$(t).parents(".nav-item").attr("data-tab-name");$(t).parents(".nav-item").attr("data-tab-name",a),$(t).parents(".nav-link").attr({id:a+"-tab","aria-controls":a,href:"#"+a}),$("#nav-tabContent").find("#"+n).attr({id:a,"aria-labelledby":a+"-tab"}),changePageName(a,n)}}})}}function turnOnDND(t,n){var i=t.item,e=unescape($(i).attr("data-content")),a=$(i).attr("data-key");$(i).html(e);var o=taoIdNgauNhien(10);$(i).attr("id","dab-item-"+o),"gird"===a||"row"===a?($(i).find(".container, .container-fluid").each(function(t,e){var a=taoIdNgauNhien(10);$(this).attr("id","dab-item-"+a),$(i).find(".container").addClass("dab-item-gird").attr("data-title",".container"),$(i).find(".container-fluid").addClass("dab-item-gird").attr("data-title",".container-fluid"),frameChild(n,a),$(this).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove-child" data-id="dab-item-'+o+'"><i class="fa fa-times"></i></span>')}),$(i).find(".row").each(function(t,e){$(i).find(".row").addClass("dab-item-row"),$(this).find("div").each(function(t,e){var a=taoIdNgauNhien(10);$(this).attr("id","dab-item-"+a),$(this).addClass("dab-item-col").attr("data-title",".col"),frameChild(n,a)}),$(this).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove-child" data-id="dab-item-'+o+'"><i class="fa fa-times"></i></span>')})):$(i).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove" data-id="dab-item-'+o+'"><i class="fa fa-times"></i></span>')}function frameChild(a,t){var e=a.contentDocument.getElementById("dab-item-"+t);new Sortable.create(e,{ghostClass:"canhcam-ghost",group:{name:"chilsList",put:["mainList","chilsList"]},onMove:function(t,e){$("#nav-tabContent").addClass("active"),$(a).contents().find("body").addClass("active"),$(".accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$(a).contents().find("body").addClass("active"),$(".accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$(a).contents().find("body").addClass("active"),$(".accordion").addClass("remove")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$(a).contents().find("body").removeClass("active"),$(".accordion").removeClass("remove"),toggleContentReadyDAB(a),reFrame()},onAdd:function(t){toggleContentReadyDAB(a),reFrame(),turnOnDND(t,a)},animation:100,filter:".dab-item-remove",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;$(t.item).closest(".dab-item").remove(),toggleContentReadyDAB(a),reFrame()}})}function taoIframe(a){var t=a.contentDocument.getElementById("listWithHandle");new Sortable.create(t,{ghostClass:"canhcam-ghost",group:{name:"chilsList",put:["mainList","chilsList"]},onMove:function(t,e){$("#nav-tabContent").addClass("active"),$(a).contents().find("body").addClass("active"),$(".accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$(a).contents().find("body").addClass("active"),$(".accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$(a).contents().find("body").addClass("active"),$(".accordion").addClass("remove")},onAdd:function(t){toggleContentReadyDAB(a),reFrame(),turnOnDND(t,a)},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$(a).contents().find("body").removeClass("active"),$(".accordion").removeClass("remove"),toggleContentReadyDAB(a),reFrame()},animation:100,filter:".dab-item-remove",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;$(t.item).closest(".dab-item").remove(),toggleContentReadyDAB(a),reFrame()}});$(".mainList").on("dragenter",function(){$(".sortable-ghost",t).remove()})}function taoTrangIndexDAB(){if(1==pagesLists.length){var t="index",e=document.createElement("iframe");e.src="/views/iframe.html",e.width="100%",e.className="frameNewlist",e.onload=function(){taoIframe(e)},$(".noleft .nav-tabs").append('<li class="nav-item" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i>'+t+".html</a></li>"),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="index" role="tabpanel" aria-labelledby="index-tab"></div>'),$("#toDoList")[0].reset(),$("#index-tab").trigger("click"),$("#"+t).html(e),$("#"+t).append('<iframe src="/views/mode.html" class="framePreview d-none"></iframe>'),$("#"+t).append('<iframe src="/views/edit.html" class="frameEdit d-none"></iframe>'),createPageBuilderDAB(t),checkTab()}}function reFrame(){$(".frameNewlist, .framePreview, .frameEdit").each(function(t,e){var a=this;$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(this).removeAttr("style"),setTimeout(function(){var t=$(a).contents().height();$(a).css({height:t+"px","min-height":t+"px"}),loadingPage()},1e3)})}function toggleContentReadyDAB(t){var e=!0;$(".frameNewlist").each(function(){0<$(this).contents().find("#listWithHandle").html().trim().length?(e=!1,$(this).contents().find("#listWithHandle").addClass("cnt")):$(this).contents().find("#listWithHandle").removeClass("cnt")}),e||unSavePage()}function createLeftMenuListDAB(){jQuery.get("/data-dab.json",function(t){var e=t,a=0,n=0,i="",o="collapsed";for(var d in e){0==n?(i=" show",o=""):(i="",o=" collapsed");var s=Object.keys(e[d]).length;a=+a+s;var r=document.createElement("div");for(var c in r.id="cc-menu-dab-"+d,r.setAttribute("data-tab-id",taoIdNgauNhien(25)),r.innerHTML='<div class="card"><div class="card-header" id="heading-dab-'+d+'"><h5 class="mb-0"><button class="btn btn-link '+o+' d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#collapse-dab-'+d+'" aria-expanded="true" aria-controls="collapse-dab-'+d+'">'+d.replace("-"," ").toUpperCase()+' <span class="badge badge-secondary">'+s+'</span></button></h5></div><div id="collapse-dab-'+d+'" class="collapse'+i+'" aria-labelledby="heading-dab-'+d+'" data-parent="#accordion-dab"><div class="card-body"><div class="slider-items list-group mainList"></div></div></div>',$("#accordion-dab").append(r),e[d]){var l=e[d][c][0],m=e[d][c][1],f='<div class="dab-item" data-dab="true" data-key='+d+" data-content="+escape(m)+">"+l+"</div>";d&&($("#cc-menu-dab-"+d).length&&$("#cc-menu-dab-"+d+" .mainList").append(f),$(".mainList").each(function(t,e){new Sortable.create(e,{group:{name:"mainList",pull:"clone",put:!1},ghostClass:"canhcam-ghost",sort:!1,animation:100,onMove:function(t,e){$("#nav-tabContent").addClass("active"),$("#nav-tabContent iframe.frameNewlist").contents().find("body").addClass("active")},onClone:function(t){$("#nav-tabContent").addClass("active"),$("#nav-tabContent iframe.frameNewlist").contents().find("body").addClass("active")},onStart:function(t){$("#nav-tabContent").addClass("active"),$("#nav-tabContent iframe.frameNewlist").contents().find("body").addClass("active")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$("#nav-tabContent iframe.frameNewlist").contents().find("body").removeClass("active")}})}))}n++}buildTotalDAB(a)})}function buildTotalDAB(n){jQuery.get("/version.json",function(t){var e=t;$("#version").html(e.version+" "+e.build),$("#accordion-dab").append('<div class="total p-2 small">S&#x1ED1; th&#xE0;nh ph&#x1EA7;n: <span class="text-info">'+n+'</span><br>Phi&#xEA;n b&#x1EA3;n: <span class="text-info">'+e.version+" "+e.build+'</span><br>Phi&#xEA;n b&#x1EA3;n Bootstrap: <span class="text-info">'+e.bootstrap+'</span><br>T&#xE1;c gi&#x1EA3;: <span class="text-info">B&#x1EA3;o Nguy&#xEA;n</span></div>'),$("#logopage .text-success").html("DAB");var a=$(".memory").attr("data-memory").split(";");$("#accordion-dab .total").append('<br>Bộ nhớ sử dụng: <span class="text-info">'+parseInt(a[1]).toFixed(0)+"MB</span>"),$("#accordion-dab .total").append('<br>Platform: <span class="text-info">'+a[3].charAt(0).toUpperCase()+a[3].slice(1)+"</span>"),$("#accordion-dab .total").append('<br>Node: <span class="text-info">v'+a[4]+"</span>")})}function buildFormAddComponentDAB(){$("#formAddComponentDAB select").html("<option selected disabled>Vui lòng chọn</option>"),$("#formAddComponentDAB")[0].reset(),$("#formAddComponentDAB .textresult").html("..."),jQuery.get("/data-dab.json",function(t){var e="";for(var a in t)if(t.hasOwnProperty(a)){var n=Object.keys(t[a]).length;e+="<option data-comnum="+(n+1)+" data-count="+a.charAt(0)+"-"+(n+1)+" value="+a+">"+a.charAt(0).toUpperCase()+a.slice(1)}$("#formAddComponentDAB select").append(e).on("change",function(t){var e=$("option:selected",this).attr("data-count"),a=$("option:selected",this).attr("data-type"),n=$("option:selected",this).attr("data-comnum");$("#formAddComponentDAB .textresult").html(t.target.value+"/"+e),$("#formAddComponentDAB #comkeyElm").val(e),$("#formAddComponentDAB #commainElm").val(a),$("#formAddComponentDAB #comnumElm").val(n),$("#formAddComponentDAB #nameCompoElm").val(t.target.value.charAt(0).toUpperCase()+t.target.value.slice(1).replace("-"," ")+" "+n)})})}function formatXml(t){var o="";t=t.replace(/(>)(<)(\/*)/g,"$1\r\n$2$3");var d=0;return jQuery.each(t.split("\r\n"),function(t,e){var a=0;e.match(/.+<\/\w[^>]*>$/)?a=0:e.match(/^<\/\w/)?0!=d&&(d-=1):a=e.match(/^<\w([^>]*[^\/])?>.*$/)?1:0;for(var n="",i=0;i<d;i++)n+="  ";o+=n+e+"\r\n",d+=a}),o}function getExitsProject(){jQuery.get("/getreadysite",function(t){var i,e=t;$("#typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"getExitsProject",source:(i=e,function(t,e){var a,n;a=[],n=new RegExp(t,"i"),$.each(i,function(t,e){n.test(e)&&a.push(e)}),e(a)})})})}function showTour(){var t=new Tour({steps:[{element:"#accordion",placement:"bottom",title:"Thư viện components",content:"Kéo thả các components dưới đây vago màn hình bên phải."},{element:"#accordion-dab",placement:"bottom",title:"Thư viện components",content:"Kéo thả các components dưới đây vago màn hình bên phải."},{element:"#index-tab",placement:"right",title:"Trang & Contents",content:"Bạn có thể thêm/sửa/xóa trang và dàn layout cho trang"},{element:"#toDoList input",placement:"top",title:"Tạo trang mới",content:"Bạn có thể thêm/sửa/xóa trang và dàn layout cho trang"},{element:"#tooglepc",placement:"top",title:"Chế độ test",content:"Chuyển đổi qua lại giữa các chế độ test"},{element:"#nav-tabContent",placement:"top",title:"Layout chính",content:"Màn hình preview hoạt động/hiển thị của components"},{element:"#createSite",placement:"bottom",title:"Tạo Site",content:"Hoàn tất dự án"}]});t.init(),t.start(),$("#retour").click(function(){t.restart()})}$("#editContentModal #saveIt").click(function(){var t=CKEDITOR.instances.editor.getData();dab.frameEdit.find("#"+dab.keyEdit).attr("data-content",escape(t)),dab.frameEdit.find("#"+dab.keyEdit).html(t),dab.frameEdit.find("#"+dab.keyEdit).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove" data-id="'+dab.keyEdit+'"><i class="fa fa-times"></i></span>'),$("#editContentModal").modal("hide");var e=dab.frameEdit.contents().find("body").html();$("#nav-tabContent .tab-pane.active").find(".frameNewlist").contents().find("#listWithHandle").html(e)}),$("#toogleexport").click(function(){modePreview();var t=$("#nav-tabContent .tab-pane.active").find(".framePreview").contents().find("body").html();$("#elmExp #langhtml").html(t.trim()),$("#elmExp .modal-body pre code").html(formatXml(t.trim()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"\n")),$("pre code").each(function(t,e){hljs.highlightBlock(e)})}),key.filter=function(t){var e=(t.target||t.srcElement).tagName;return!("SELECT"==e||"TEXTAREA"==e)},key("ctrl+alt+d,⌘+alt+d",function(){return $("#toDoListMain input").focus(),!1}),key("ctrl+alt+e,⌘+alt+e",function(){return $("#toDoList button").click(),$("#toDoListMain button").click(),!1}),key("ctrl+alt+p,⌘+alt+p",function(){return $("#toDoList input").focus(),!1}),key("ctrl+alt+l,⌘+alt+l",function(){return $("#tooglepc").click(),!1}),key("ctrl+alt+m,⌘+alt+m",function(){return $("#tooglemobile").click(),!1}),key("ctrl+alt+t,⌘+alt+t",function(){return $("#toogletablet").click(),!1}),key("ctrl+alt+n,⌘+alt+n",function(){return $(".togglemenu").click(),!1}),getExitsProject();